generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model categoria {
  id_categoria     Int         @id @default(autoincrement())
  nome             String      @unique(map: "nome") @db.VarChar(100)
  descricao        String?     @db.Text
  id_categoria_pai Int?
  categoria        categoria?  @relation("categoriaTocategoria", fields: [id_categoria_pai], references: [id_categoria], onUpdate: NoAction, map: "categoria_ibfk_1")
  other_categoria  categoria[] @relation("categoriaTocategoria")
  produto          produto[]

  @@index([id_categoria_pai], map: "id_categoria_pai")
}

model cliente {
  id_cliente      Int        @id @default(autoincrement())
  nome_completo   String     @db.VarChar(255)
  cpf             String     @unique(map: "cpf") @db.VarChar(11)
  email           String     @unique(map: "email") @db.VarChar(255)
  celular         String     @db.VarChar(15)
  data_nascimento DateTime?  @db.Date
  endereco        endereco[]
  pedido          pedido[]
}

model endereco {
  id_endereco Int      @id @default(autoincrement())
  id_cliente  Int
  logradouro  String   @db.VarChar(255)
  numero      String   @db.VarChar(10)
  complemento String?  @db.VarChar(100)
  bairro      String   @db.VarChar(100)
  cidade      String   @db.VarChar(100)
  estado      String   @db.VarChar(2)
  cep         String   @db.VarChar(8)
  cliente     cliente  @relation(fields: [id_cliente], references: [id_cliente], onDelete: Cascade, onUpdate: NoAction, map: "endereco_ibfk_1")
  pedido      pedido[]

  @@index([id_cliente], map: "id_cliente")
}

model item_pedido {
  id_pedido      Int
  id_produto     Int
  quantidade     Int
  preco_unitario Decimal @db.Decimal(10, 2)
  pedido         pedido  @relation(fields: [id_pedido], references: [id_pedido], onDelete: Cascade, onUpdate: NoAction, map: "item_pedido_ibfk_1")
  produto        produto @relation(fields: [id_produto], references: [id_produto], onUpdate: NoAction, map: "item_pedido_ibfk_2")

  @@id([id_pedido, id_produto])
  @@index([id_produto], map: "id_produto")
}

model numero_serie {
  id_numero_serie Int                 @id @default(autoincrement())
  id_produto      Int
  codigo_serial   String              @unique(map: "codigo_serial") @db.VarChar(255)
  status          numero_serie_status @default(dbgenerated("(_utf8mb4\\'Disponivel\\')"))
  produto         produto             @relation(fields: [id_produto], references: [id_produto], onDelete: Cascade, onUpdate: NoAction, map: "numero_serie_ibfk_1")

  @@index([id_produto], map: "id_produto")
}

model pedido {
  id_pedido         Int           @id @default(autoincrement())
  id_cliente        Int
  id_endereco_envio Int
  data_hora         DateTime      @default(now()) @db.Timestamp(0)
  forma_pagamento   String        @db.VarChar(50)
  desconto          Decimal?      @default(0.00) @db.Decimal(10, 2)
  total_compra      Decimal       @db.Decimal(10, 2)
  status            pedido_status @default(Processando)
  item_pedido       item_pedido[]
  cliente           cliente       @relation(fields: [id_cliente], references: [id_cliente], onUpdate: NoAction, map: "pedido_ibfk_1")
  endereco          endereco      @relation(fields: [id_endereco_envio], references: [id_endereco], onUpdate: NoAction, map: "pedido_ibfk_2")

  @@index([id_cliente], map: "id_cliente")
  @@index([id_endereco_envio], map: "id_endereco_envio")
}

model produto {
  id_produto     Int            @id @default(autoincrement())
  id_categoria   Int
  modelo         String         @db.VarChar(255)
  fabricante     String?        @db.VarChar(100)
  preco_base     Decimal        @db.Decimal(10, 2)
  qtd_disponivel Int            @default(0)
  item_pedido    item_pedido[]
  numero_serie   numero_serie[]
  categoria      categoria      @relation(fields: [id_categoria], references: [id_categoria], onUpdate: NoAction, map: "produto_ibfk_1")

  @@index([id_categoria], map: "id_categoria")
}

enum numero_serie_status {
  Dispon_vel @map("Dispon√≠vel")
  Vendido
}

enum pedido_status {
  Processando
  Pagamento_Aprovado @map("Pagamento Aprovado")
  Enviado
  Entregue
  Cancelado
}
